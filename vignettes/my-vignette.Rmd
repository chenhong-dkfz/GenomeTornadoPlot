---
title: "Tornado Plots for Copy Number Variations"
author: "Chen Hong"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## About TornadoPlot

The TornadoPlot package is used to visualise copy number variations (or any other types of structure variations as well) which overlap with one or two genes in one chromosomes.A focallity score is also calculated for all CNVs overlapping with the target gene. 

With `TornadoPlot` function, you are able to:
- visualise alternatively selected CNVs overlapping with gene(s) in cohort level
- calculate focallity scores by different methods
- graphically compare CNVs between neighbour genes


## Download and installation

You can download TornadoPlot by downloading it from github:

https://github.com/chenhong-dkfz/tornado.test.1

## Usage

TornadoPlot package can be applied to your CNV data. Basically, you can use `MakeData` function to convert data.frame object to standard input object of `TornadoPlot` function. 

To run `MakeData` function:

```
data <- MakeData(CNV_1,gene_name_1,start_1,end_1,CNV_2, gene_name_2,start_2,end_2, chrom, type)

```

Here **CNV_1** is your input data frame of CNV information. The input table should be like this:


```{r, echo=FALSE, results='asis'}
data("cnv_KRAS",package = "tornado.test.1")
knitr::kable(head(cnv_KRAS, 10))
```

The **score** column records copy numbers of each CNV.


The other parameters are defined:

1. **gene_name_1**: the name of the first gene.
1. **start_1**:the start position of the first gene.
1. **end_1**:the end position of the first gene.
1. **gene_name_2**: the name of the second gene, optional.
1. **start_2**:the start position of the second gene, optional.
1. **end_2**:the end position of the second gene, optional.
1. **chrom**:the chromosome where genes are located.
1. **type**:CNV type filter, optional.

if gene_name_2,start_2 and end_2 are given by user, `MakeData` function will generate an object for single-gene cnv, otherwise would make an object for twin-gene cnvs. 



```
cnv.plot <- TornadoPlots(data, legend, color, color.method, sort.method, SaveAsObject)
```
1. **data**: generated by `MakeData` function.
1. **legend**: could be set to "pie" and "normal", optional.
#1. **out.dir**: path to save the output tornado plot, optional.
#1. **file.type**: set the format of output tornado plot. The plot is defaultly saved in tiff format, optional.
1. **color**: a vector of CNV colors, optional.
1. **color.method**: how to color the CNVs. It could be "cohort" or "ploidy", optional.
1. **sort.method**: how to sort the CNVs. It could be "length",cohort" or "ploidy", optional.
1. **SaveAsObject**: if it is TRUE, return an rastergrob object. Otherwise the function only save the plot in file without return anything.

## Example

You can simply use the following code to make a tornado plot:
```
data("cnv_KRAS",package = "tornado.test.1")
data_kras <-  MakeData(CNV_1=cnv_KRAS,gene_name_1 = "KRAS",start_1 = 25204789, end_1 = 25250936, chrom = 12)
plot_kras <- TornadoPlots(data_kras,gene.name="KRAS",sort.method="cohort",,SaveAsObject=T)
grid.arrange(plot_kras)
```


